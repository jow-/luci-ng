{
  "widget": "set-page",
  "waitFor": "_system = uci.loadConfig('system') , data=RxObject({})",
  "content": [
    {
      "widget": "set-section",
      "options": { "title": "General" },
      "content": [
        {
          "widget": "set-input",
          "bind": "uci.configs.system['@system'][0].hostname",
          "options": { "title": "Hostname" }
        }
      ]
    },
    {
      "widget": "set-section",
      "options": { "title": "Time & Date" },
      "content": "load('views/system/system.time.json')"
    },
    {
      "widget": "set-section",
      "options": { "title": "Administration" },
      "content": [
        {
          "widget": "set-popup",
          "options": {
            "title": "Password",
            "description": "Changes the administrator password for accessing the device",
            "popupTitle": "Change Password"
          },
          "content": "load('views/system/system.psw.json')"
        },
        {
          "widget": "set-expansion",
          "waitFor": "uci.loadConfig('dropbear')",
          "options": {
            "title": "SSH Access",
            "description=": "`${uci.configs.dropbear['@dropbear'].length} instances`"
          },
          "content": [
            {
              "widget": "set-rowarray",
              "bind": "uci.configs.dropbear['@dropbear']",
              "options": { "newRow": "{}" },

              "content": [
                {
                  "widget": "set-expansion",

                  "options": {
                    "title=": "`Port ${$data.Port} [${$data.Interface.join('-') || '*'}]`"
                  },

                  "content": [
                    {
                      "widget": "set-input",
                      "bind": "$data.Port",
                      "options": { "title": "Port" }
                    },
                    {
                      "widget": "set-popup",
                      "options": {
                        "title": "Interface",
                        "description=": "`${$data.Interface.join('-') || '*'}`",
                        "popupTitle": "Select Interfaces"
                      }
                    },
                    {
                      "widget": "set-expansion",
                      "options": { "title": "Advanced" }
                    }
                  ]
                }
              ]
            },

            {
              "widget": "set-expansion",
              "options": { "title": "SSH Keys", "description": "Manage authorization keys" }
            }
          ]
        },

        {
          "widget": "set-button",
          "options": {
            "title": "Restart Device",
            "buttonTitle": "Reboot",
            "click": "ubus('luci2.system', 'reboot')"
          }
        }
      ]
    },
    {
      "widget": "set-section",
      "options": { "title": "Backup & Upgrade" },
      "content": [
        {
          "widget": "set-popup",
          "options": {
            "title": "Firmware",
            "description": "Flash new firmware image",
            "popupTitle": "Flash"
          },
          "content": "load('views/system/system.firmware.json')"
        },
        {
          "widget": "set-button",
          "options": {
            "title": "Backup",
            "description": "Download a tar archive of the current configuration files",
            "buttonTitle": "Generate",
            "click": "$tmp.loading=true, cgi.backup() || ($tmp.loading=false)",
            "spinner=": "$tmp.loading"
          }
        },
        {
          "widget": "set-link",
          "options": {
            "title": "Configure",
            "description": "List files/folder to keep & backup",
            "link": "system/backup"
          }
        },
        {
          "widget": "set-expansion",
          "options": { "title": "Restore" },
          "content": [
            {
              "widget": "set-button",
              "options": {
                "title": "From backup",
                "description": "Upload a previously generated backup archive",
                "buttonTitle": "Upload"
              }
            },
            {
              "widget": "set-button",
              "options": {
                "title": "Restore defaults",
                "description": "Revert to default configuration",
                "buttonTitle": "Reset"
              }
            },
            {
              "widget": "set-button",
              "options": {
                "title": "Restore to previous",
                "description": "Revert to previous firmware",
                "buttonTitle": "Rollback"
              }
            }
          ]
        }
      ]
    },
    {
      "widget": "set-section",
      "options": { "title": "Programs & Tasks" },
      "content": [
        {
          "widget": "set-link",
          "options": {
            "title": "Startup",
            "description": "Manage installed init scripts",
            "link": "system/startup"
          }
        },
        {
          "widget": "set-link",
          "options": {
            "title": "Software",
            "description": "Install & manage programs",
            "link": "system/software"
          }
        },
        {
          "widget": "set-link",
          "options": {
            "title": "Scheduled Tasks",
            "description": "Manage Crontab tasks",
            "link": "system/schedule"
          }
        }
      ]
    },
    {
      "widget": "set-sectiongroup",
      "options": { "title": "Advanced" },
      "content": [
        {
          "widget": "set-section",
          "options": { "title": "Logging" },
          "content": [
            {
              "widget": "set-expansion",
              "options": { "title": "System Log" },
              "content": [
                {
                  "widget": "set-input",
                  "bind": "uci.configs.system['@system'][0].log_buffer_size",
                  "options": {
                    "title": "Buffersize",
                    "description": "System log in memory buffer size [kB]"
                  }
                },
                {
                  "widget": "set-expansion",
                  "options": {
                    "title": "File Log",
                    "description=": "uci.configs.system['@system'][0].log_file ? `Logging to ${uci.configs.system['@system'][0].log_file}` : 'Disabled'"
                  },
                  "content": [
                    {
                      "widget": "set-input",
                      "bind": "uci.configs.system['@system'][0].log_file",
                      "options": {
                        "title": "Log file",
                        "description": "File to write log messages to."
                      }
                    },
                    {
                      "widget": "set-input",
                      "bind": "uci.configs.system['@system'][0].log_size",
                      "options": {
                        "title": "Buffersize",
                        "description": "Size of the file buffer in KiB [kB]"
                      }
                    }
                  ]
                },
                {
                  "widget": "set-toggle",
                  "bind": "uci.configs.system['@system'][0].log_remote",
                  "options": {
                    "title": "Remote Logging",
                    "description": "Log messages to server in addition to the local destination."
                  },
                  "content": [
                    {
                      "widget": "set-input",
                      "bind": "uci.configs.system['@system'][0].log_ip",
                      "options": {
                        "title": "Remote Syslog Server IP"
                      }
                    },
                    {
                      "widget": "set-input",
                      "bind": "uci.configs.system['@system'][0].log_port",
                      "options": {
                        "title": "Remote Port"
                      }
                    },
                    {
                      "widget": "set-input",
                      "bind": "uci.configs.system['@system'][0].log_proto",
                      "options": {
                        "title": "Protocol",
                        "description": "Sets the protocol to use for the connection"
                      }
                    },
                    {
                      "widget": "set-input",
                      "bind": "uci.configs.system['@system'][0].log_hostname",
                      "options": {
                        "title": "Hostname for log"
                      }
                    },
                    {
                      "widget": "set-toggle",
                      "bind": "uci.configs.system['@system'][0].log_trailer_null",
                      "options": {
                        "title": "Trailer null",
                        "description": "Use \\0 instead of \\n as trailer when using TCP."
                      }
                    },
                    {
                      "widget": "set-input",
                      "bind": "uci.configs.system['@system'][0].log_prefix",
                      "options": {
                        "title": "Log prefix",
                        "description": "Adds a prefix to all log messages send over network"
                      }
                    }
                  ]
                }
              ]
            },
            {
              "widget": "set-expansion",
              "options": {
                "title": "Kernel Log",
                "expanded": true
              },
              "content": [
                {
                  "widget": "set-input",
                  "bind": "uci.configs.system['@system'][0].buffersize",
                  "options": {
                    "title": "Buffersize",
                    "description": "Size of the kernel message buffer"
                  }
                },
                {
                  "widget": "set-slider",
                  "bind": "uci.configs.system['@system'][0].conloglevel",
                  "options": {
                    "title": "Log Level",
                    "description": "Maximum log level for kernel messages to be logged to the console",
                    "min": 1,
                    "max": 8
                  }
                }
              ]
            },
            {
              "widget": "set-slider",
              "bind": "uci.configs.system['@system'][0].cronloglevel",
              "options": { "title": "Cron log level", "min": 0, "max": 15 }
            }
          ]
        },
        {
          "widget": "set-section",
          "options": { "title": "Leds" },
          "displayIf": "ubus('file', 'list', {path:'/sys/class/leds'} ).entries.length",
          "content": [
            {
              "widget": "schema-form",
              "options": {
                "schema=": "uci.getSchema('system','@led')",
                "bind": "uci.configs.system['@led']"
              }
            }
          ]
        }
      ]
    }
  ]
}
